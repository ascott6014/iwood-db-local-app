<form action="/create-install" method="POST">
  <h3>Lookup Customer</h3>
  <input type="text" id="customerSearch" placeholder="Type name or phone..." autocomplete="off" />
  <select id="customerResults" required>
    <option value="">Select a customer...</option>
  </select>
  <input type="hidden" name="customer_id" id="customer_id" />

  <!-- Rest of the install form -->
  <h3>Install Info</h3>
  <input name="description" required placeholder="Install Description" />
  <input name="cost" required type="number" step="0.01" placeholder="Install Cost" />
  <input name="install_date" required type="date" />
  <textarea name="install_notes" placeholder="Install Notes"></textarea>

  <button type="submit">Create Install</button>
</form>
<script>
  const searchInput = document.getElementById('customerSearch');
  const resultsSelect = document.getElementById('customerResults');
  const hiddenIdField = document.getElementById('customer_id');

  searchInput.addEventListener('input', async () => {
    const query = searchInput.value.trim();
    if (!query) return;

    try {
      const response = await fetch(`/api/customers/search?q=${encodeURIComponent(query)}`);
      const customers = await response.json();

      resultsSelect.innerHTML = '<option value="">Select a customer...</option>';
      customers.forEach(c => {
        const option = document.createElement('option');
        option.value = c.customer_id;
        option.text = `${c.first_name} ${c.last_name} (${c.phone})`;
        resultsSelect.appendChild(option);
      });
    } catch (err) {
      resultsSelect.innerHTML = '<option value="">Error loading results</option>';
    }
  });

  resultsSelect.addEventListener('change', () => {
    hiddenIdField.value = resultsSelect.value;
  });
</script>
