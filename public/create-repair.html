<form action="/repairs/create-repair" method="POST">
    <h3>Lookup Customer</h3>
  <input type="text" id="customerSearch" placeholder="Type name or phone..." autocomplete="off" />
  <select id="customerResults" required>
    <option value="">Select a customer...</option>
  </select>
  <input type="hidden" name="customer_id" id="customer_id" />
  <h3>Repair Info</h3>
  <input name="items_brought" placeholder="Items Brought" required />
  <input name="problem" placeholder="Problem Description" required />
  <input name="solution" placeholder="Solution" required />
  <input name="repair_cost" placeholder="Repair Cost" type="number" step="0.01" required />
  <select name="status">
    <option value="Not Started">Not Started</option>
    <option value="In Progress">In Progress</option>
    <option value="Completed">Completed</option>
    <option value="Unsuccessful">Unsuccessful</option>
  </select>
  <textarea name="notes" placeholder="Repair Notes"></textarea>
  <input name="start_date" type="datetime-local" required />
  <input name="end_date" type="datetime-local" required />

  <button type="submit">Create Repair</button>
</form>
<script>
  const searchInput = document.getElementById('customerSearch');
  const resultsSelect = document.getElementById('customerResults');
  const hiddenIdField = document.getElementById('customer_id');

  searchInput.addEventListener('input', async () => {
    const query = searchInput.value.trim();
    if (!query) return;

    try {
      const response = await fetch(`/api/customers/search?q=${encodeURIComponent(query)}`);
      const customers = await response.json();

      resultsSelect.innerHTML = '<option value="">Select a customer...</option>';
      customers.forEach(c => {
        const option = document.createElement('option');
        option.value = c.customer_id;
        option.text = `${c.first_name} ${c.last_name} (${c.phone})`;
        resultsSelect.appendChild(option);
      });
    } catch (err) {
      resultsSelect.innerHTML = '<option value="">Error loading results</option>';
    }
  });

  resultsSelect.addEventListener('change', () => {
    hiddenIdField.value = resultsSelect.value;
  });
</script>
